"use strict";exports.id=47,exports.ids=[47],exports.modules={2047:(e,t,i)=>{i.d(t,{Gt:()=>withSubscriptionProtection,a9:()=>PaywallProvider,nL:()=>usePaywall,qr:()=>useSubscriptionAccess});var a=i(997),r=i(9816),s=i.n(r),o=i(6689),n=i(3400),c=i(8349);let l=(0,o.createContext)(void 0),PaywallProvider=({children:e,autoCheckSubscription:t=!0,debugMode:i=!1})=>{let[r,s]=(0,o.useState)(null),[u,d]=(0,o.useState)(null),[b,g]=(0,o.useState)(!1),[h,p]=(0,o.useState)(!0),[m,f]=(0,o.useState)(null),[S,x]=(0,o.useState)(!1),C=(0,o.useCallback)((...e)=>{i&&console.log("[PaywallProvider]",...e)},[i]);(0,o.useEffect)(()=>{w()},[]),(0,o.useEffect)(()=>{if(t&&h){let e=n.h7.getCachedCustomerId();e?y(e).finally(()=>{p(!1)}):p(!1)}},[t,h]);let w=(0,o.useCallback)(()=>{try{let e=n.h7.getCachedCustomerId(),t=n.h7.getCachedCustomerEmail();e&&t&&d({customer_id:e,email:t,created:0});let i=n.h7.getCachedSubscriptionStatus();C("Loaded cached subscription status:",i)}catch(e){C("Failed to load cached data:",e)}},[C]),y=(0,o.useCallback)(async e=>{try{g(!0),f(null);let t=e||n.h7.getCachedCustomerId();if(!t)return C("No customer ID available for subscription check"),!1;C("Checking subscription for customer:",t);let i=await n.h7.getSubscriptionStatus(t);if(i.has_subscription&&i.subscription_data)return s(i.subscription_data),C("Subscription found:",i.subscription_data),(0,c.BZ)(i.subscription_data.status);return s(null),C("No subscription found"),!1}catch(t){let e=t instanceof Error?t.message:"Failed to check subscription";return C("Subscription check error:",e),f(e),!1}finally{g(!1)}},[C]),k=(0,o.useCallback)(async()=>{let e=u?.customer_id||n.h7.getCachedCustomerId();e&&await y(e)},[u,y]),_=(0,o.useCallback)((e,t)=>{let i={customer_id:"",email:e,name:t,created:Date.now()/1e3};d(i),C("Customer info set:",i)},[C]),I=(0,o.useCallback)(()=>{s(null),d(null),f(null),n.h7.clearCache(),C("Subscription data cleared")},[C]),L=!!r&&(0,c.BZ)(r.status),v=r?.status||null;return a.jsx(l.Provider,{value:{subscription:r,customer:u,hasActiveSubscription:L,subscriptionStatus:v,isLoading:b,isInitializing:h,error:m,checkSubscription:y,refreshSubscription:k,setCustomerInfo:_,clearSubscriptionData:I,showPaywall:S,setShowPaywall:x},children:e})},usePaywall=()=>{let e=(0,o.useContext)(l);if(void 0===e)throw Error("usePaywall must be used within a PaywallProvider");return e},useSubscriptionAccess=()=>{let{hasActiveSubscription:e,isLoading:t,isInitializing:i}=usePaywall();return{hasAccess:e,isLoading:t||i,needsSubscription:!e&&!t&&!i}},withSubscriptionProtection=(e,t={})=>{let ProtectedComponent=i=>{let{hasAccess:r,isLoading:n,needsSubscription:c}=useSubscriptionAccess(),{setShowPaywall:l}=usePaywall();return((0,o.useEffect)(()=>{c&&!1!==t.showPaywall&&l(!0)},[c,l]),n)?a.jsx(a.Fragment,{children:t.loadingComponent||(0,a.jsxs)("div",{className:"jsx-fe4b9d12fc145224 subscription-loading",children:[a.jsx("div",{className:"jsx-fe4b9d12fc145224 loading-spinner"}),a.jsx("p",{className:"jsx-fe4b9d12fc145224",children:"Checking subscription..."}),a.jsx(s(),{id:"fe4b9d12fc145224",children:".subscription-loading.jsx-fe4b9d12fc145224{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;min-height:200px;text-align:center}.loading-spinner.jsx-fe4b9d12fc145224{width:40px;height:40px;border:3px solid rgba(255,255,255,.1);border-top:3px solid#007bff;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;-webkit-animation:spin 1s linear infinite;-moz-animation:spin 1s linear infinite;-o-animation:spin 1s linear infinite;animation:spin 1s linear infinite;margin-bottom:1rem}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-moz-keyframes spin{0%{-moz-transform:rotate(0deg);transform:rotate(0deg)}100%{-moz-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes spin{0%{-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{0%{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}p.jsx-fe4b9d12fc145224{color:rgba(255,255,255,.7);margin:0}"})]})}):c?(t.redirectTo,a.jsx(a.Fragment,{children:t.blockedComponent||(0,a.jsxs)("div",{className:"jsx-a2b4dda25c201926 subscription-required",children:[a.jsx("div",{className:"jsx-a2b4dda25c201926 blocked-icon",children:"\uD83D\uDD12"}),a.jsx("h2",{className:"jsx-a2b4dda25c201926",children:"Subscription Required"}),a.jsx("p",{className:"jsx-a2b4dda25c201926",children:"This feature requires an active WebAI subscription. Please subscribe to continue."}),a.jsx("button",{onClick:()=>l(!0),className:"jsx-a2b4dda25c201926 subscribe-button",children:"Subscribe Now ($2/month)"}),a.jsx(s(),{id:"a2b4dda25c201926",children:".subscription-required.jsx-a2b4dda25c201926{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;min-height:300px;text-align:center;padding:2rem}.blocked-icon.jsx-a2b4dda25c201926{font-size:4rem;margin-bottom:1rem;opacity:.7}h2.jsx-a2b4dda25c201926{margin:0 0 1rem 0;color:#fff;font-size:1.75rem;font-weight:600}p.jsx-a2b4dda25c201926{color:rgba(255,255,255,.7);margin:0 0 2rem 0;line-height:1.5;max-width:400px}.subscribe-button.jsx-a2b4dda25c201926{background:#007bff;color:#fff;border:none;padding:1rem 2rem;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;font-weight:600;font-size:1rem;cursor:pointer;-webkit-transition:all.2s ease;-moz-transition:all.2s ease;-o-transition:all.2s ease;transition:all.2s ease}.subscribe-button.jsx-a2b4dda25c201926:hover{background:#0056b3;-webkit-transform:translatey(-2px);-moz-transform:translatey(-2px);-ms-transform:translatey(-2px);-o-transform:translatey(-2px);transform:translatey(-2px);-webkit-box-shadow:0 4px 12px rgba(0,123,255,.3);-moz-box-shadow:0 4px 12px rgba(0,123,255,.3);box-shadow:0 4px 12px rgba(0,123,255,.3)}"})]})})):a.jsx(e,{...i})};return ProtectedComponent.displayName=`withSubscriptionProtection(${e.displayName||e.name})`,ProtectedComponent}},8349:(e,t,i)=>{let a;i.d(t,{BZ:()=>hasActiveSubscription,d2:()=>getStripe,if:()=>getSubscriptionStatusColor,kU:()=>formatSubscriptionStatus,sN:()=>n});var r=i(943);let s="pk_live_51RyCT8CaH00jkWa3mAiICBrzcASMlp5suMGEW9yt4GUqzLwtS39i0Vl3v2h6brntRYrRB8lisjH8cYhcRPHwH5Pf00UaLZHtNK",o=s&&s.startsWith("pk_")&&s.length>20;if(!o){let e=`NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY environment variable is not set or invalid. Current value: ${s||"undefined"}. Please add your actual Stripe publishable key to your environment variables.`;console.warn("⚠️ STRIPE WARNING (build time):",e),console.warn("⚠️ Stripe functionality will be disabled until a valid key is provided.")}let getStripe=()=>o?(a||(a=(0,r.loadStripe)(s)),a):(console.warn("⚠️ STRIPE: Cannot initialize Stripe - invalid or missing publishable key"),Promise.resolve(null)),n={appearance:{theme:"night",variables:{colorPrimary:"#007bff",colorBackground:"#1a1a1a",colorText:"#ffffff",colorDanger:"#df1b41",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',spacingUnit:"6px",borderRadius:"8px"},rules:{".Tab":{backgroundColor:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.8)"},".Tab:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)",color:"#ffffff"},".Tab--selected":{backgroundColor:"#007bff",color:"#ffffff"},".Input":{backgroundColor:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.2)",color:"#ffffff"},".Input:focus":{border:"1px solid #007bff",boxShadow:"0 0 0 2px rgba(0, 123, 255, 0.2)"},".Label":{color:"rgba(255, 255, 255, 0.9)",fontWeight:"500"}}}};n.appearance,process.env.NEXT_PUBLIC_STRIPE_PRICE_ID;let hasActiveSubscription=e=>"active"===e||"trialing"===e,formatSubscriptionStatus=e=>{if(!e)return"No subscription";switch(e){case"active":return"Active";case"trialing":return"Trial Period";case"past_due":return"Payment Past Due";case"canceled":return"Canceled";case"unpaid":return"Unpaid";case"incomplete":return"Incomplete";case"incomplete_expired":return"Expired";default:return"Inactive"}},getSubscriptionStatusColor=e=>{if(!e)return"#6b7280";switch(e){case"active":case"trialing":return"#10b981";case"past_due":case"unpaid":return"#f59e0b";case"canceled":case"incomplete_expired":return"#ef4444";case"incomplete":return"#8b5cf6";default:return"#6b7280"}}},3400:(e,t,i)=>{i.d(t,{h7:()=>r});let getApiUrl=()=>"https://web3ai-backend-v34-api-180395924844.us-central1.run.app",a={CUSTOMER_ID:"webai_customer_id",CUSTOMER_EMAIL:"webai_customer_email",SUBSCRIPTION_STATUS:"webai_subscription_status",SUBSCRIPTION_CACHE_TIME:"webai_subscription_cache_time",SUBSCRIPTION_DATA:"webai_subscription_data"},r=new class{constructor(e=!1){this.apiUrl=getApiUrl(),this.debug=e}debugLog(...e){this.debug&&console.log("[Subscription API]",...e)}getHeaders(){return{"Content-Type":"application/json"}}async handleResponse(e){if(!e.ok){let t=await e.text().catch(()=>"Unknown error"),i=`HTTP ${e.status}: ${e.statusText}`;try{let e=JSON.parse(t);i=e.detail||i}catch{t&&(i=t)}throw Error(i)}return e.json()}setLocalStorage(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(e){this.debugLog("Failed to set localStorage:",e)}}getLocalStorage(e){try{let t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(e){return this.debugLog("Failed to get localStorage:",e),null}}removeLocalStorage(e){try{localStorage.removeItem(e)}catch(e){this.debugLog("Failed to remove localStorage:",e)}}isCacheValid(){let e=this.getLocalStorage(a.SUBSCRIPTION_CACHE_TIME);if(!e)return!1;let t=Date.now();return t-e<3e5}getCachedSubscriptionData(){return this.isCacheValid()?this.getLocalStorage(a.SUBSCRIPTION_DATA):null}cacheSubscriptionData(e){this.setLocalStorage(a.SUBSCRIPTION_DATA,e),this.setLocalStorage(a.SUBSCRIPTION_CACHE_TIME,Date.now()),this.setLocalStorage(a.SUBSCRIPTION_STATUS,e?.status||null)}getCachedCustomerId(){return this.getLocalStorage(a.CUSTOMER_ID)}getCachedCustomerEmail(){return this.getLocalStorage(a.CUSTOMER_EMAIL)}getCachedSubscriptionStatus(){return this.isCacheValid()?this.getLocalStorage(a.SUBSCRIPTION_STATUS):null}clearCache(){Object.values(a).forEach(e=>{this.removeLocalStorage(e)}),this.debugLog("Subscription cache cleared")}async createCustomer(e){this.debugLog("Creating customer:",e.email);let t=await fetch(`${this.apiUrl}/subscriptions/create-customer`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify(e)}),i=await this.handleResponse(t);return this.setLocalStorage(a.CUSTOMER_ID,i.customer_id),this.setLocalStorage(a.CUSTOMER_EMAIL,i.email),this.debugLog("Customer created:",i.customer_id),i}async findCustomerByEmail(e){this.debugLog("Finding customer by email:",e);let t=await fetch(`${this.apiUrl}/subscriptions/find-customer-by-email`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({email:e})}),i=await this.handleResponse(t);return i.found&&i.customer_data&&(this.setLocalStorage(a.CUSTOMER_ID,i.customer_data.customer_id),this.setLocalStorage(a.CUSTOMER_EMAIL,i.customer_data.email)),this.debugLog("Customer search result:",i),i}async createSubscription(e){this.debugLog("Creating subscription:",e);let t=await fetch(`${this.apiUrl}/subscriptions/create-subscription`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify(e)}),i=await this.handleResponse(t);return this.cacheSubscriptionData(i),this.debugLog("Subscription created:",i.subscription_id),i}async getSubscriptionStatus(e,t=!0){if(t){let e=this.getCachedSubscriptionData();if(e)return this.debugLog("Using cached subscription data"),{has_subscription:!0,subscription_data:e}}this.debugLog("Fetching subscription status for customer:",e);let i=await fetch(`${this.apiUrl}/subscriptions/status/${e}`,{method:"GET",headers:this.getHeaders()}),a=await this.handleResponse(i);return this.cacheSubscriptionData(a.subscription_data||null),this.debugLog("Subscription status:",a),a}async cancelSubscription(e,t=!1){this.debugLog("Cancelling subscription:",e,"immediate:",t);let i=await fetch(`${this.apiUrl}/subscriptions/cancel/${e}`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({immediate:t})}),a=await this.handleResponse(i);return this.clearCache(),this.debugLog("Subscription cancelled:",a),a}async getSubscriptionConfig(){this.debugLog("Fetching subscription config");let e=await fetch(`${this.apiUrl}/subscriptions/config`,{method:"GET",headers:this.getHeaders()}),t=await this.handleResponse(e);return this.debugLog("Subscription config:",t),t}async checkHealth(){this.debugLog("Checking subscription service health");let e=await fetch(`${this.apiUrl}/subscriptions/health`,{method:"GET",headers:this.getHeaders()}),t=await this.handleResponse(e);return this.debugLog("Subscription health:",t),t}async hasActiveSubscription(e){try{let t=e||this.getCachedCustomerId();if(!t)return this.debugLog("No customer ID available for subscription check"),!1;let i=await this.getSubscriptionStatus(t),a=i.has_subscription&&i.subscription_data&&("active"===i.subscription_data.status||"trialing"===i.subscription_data.status);return this.debugLog("Has active subscription:",a),a}catch(e){return this.debugLog("Error checking subscription status:",e),!1}}async getOrCreateCustomer(e,t){this.debugLog("Getting or creating customer for:",e);let i=await this.findCustomerByEmail(e);return i.found&&i.customer_data?(this.debugLog("Found existing customer"),i.customer_data):(this.debugLog("Creating new customer"),await this.createCustomer({email:e,name:t}))}}(!1)}};