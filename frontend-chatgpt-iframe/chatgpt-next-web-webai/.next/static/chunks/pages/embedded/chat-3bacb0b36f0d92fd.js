(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[924],{246:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/embedded/chat",function(){return a(9007)}])},2905:function(e,t,a){"use strict";a.d(t,{OY:function(){return WebAIApi},Pf:function(){return createTenantSetupApi}});var i=a(3454);let WebAIApi=class WebAIApi{debugLog(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];this.config.debug&&console.log("[WebAI API]",...t)}updateConfig(e){this.config={...this.config,...e},this.debugLog("Config updated:",this.config)}async *chat(e){let t=e[e.length-1];if(!t||"user"!==t.role)throw Error("Last message must be from user");this.abortController&&this.abortController.abort(),this.abortController=new AbortController;let a={message:t.content,session_id:this.config.sessionId,use_redis_conversations:!0,use_rag:this.config.useRAG,rag_top_k:this.config.ragTopK};this.debugLog("Sending chat request:",a);try{var i,s,n,r;let e=await fetch("".concat(this.config.apiUrl,"/chat/stream"),{method:"POST",headers:{"Content-Type":"application/json","X-Tenant-ID":this.config.tenantId},body:JSON.stringify(a),signal:this.abortController.signal});if(!e.ok){let t=await e.text().catch(()=>"Unknown error"),a="HTTP ".concat(e.status,": ").concat(e.statusText);try{let e=JSON.parse(t);a=e.detail||a}catch(e){t&&(a=t)}throw Error(a)}let t=null===(i=e.body)||void 0===i?void 0:i.getReader();if(!t)throw Error("No response body available");let o=new TextDecoder,c="",l="";for(;;){let e;let{done:a,value:i}=await t.read();if(a)break;for(c+=o.decode(i,{stream:!0});-1!==(e=c.indexOf("\n"));){let t=c.slice(0,e).trimEnd();if(c=c.slice(e+1),!t.startsWith("data: "))continue;let a=t.slice(6).trim();if("[DONE]"===a){this.debugLog("Stream completed, full response length:",l.length),yield{role:"assistant",content:"",delta:!1,finished:!0};return}try{let e=JSON.parse(a);if(e.error)throw Error(e.error);let t=null===(r=e.choices)||void 0===r?void 0:null===(n=r[0])||void 0===n?void 0:null===(s=n.delta)||void 0===s?void 0:s.content;t&&(l+=t,this.debugLog("Received delta:",t.length,"chars"),yield{role:"assistant",content:t,delta:!0})}catch(e){!this.config.debug||e instanceof SyntaxError||console.warn("[WebAI API] Parse error:",e,"for data:",a)}}}}catch(e){if(e instanceof Error){if("AbortError"===e.name){this.debugLog("Request aborted");return}this.debugLog("Chat error:",e.message),yield{role:"assistant",content:"",delta:!1,error:e.message}}else this.debugLog("Unknown error:",e),yield{role:"assistant",content:"",delta:!1,error:"An unknown error occurred"}}finally{this.abortController=null}}cancel(){this.abortController&&(this.abortController.abort(),this.abortController=null,this.debugLog("Request cancelled"))}async testConnection(){try{let e=await fetch("".concat(this.config.apiUrl,"/health"),{method:"GET",headers:{"X-Tenant-ID":this.config.tenantId}}),t=e.ok;return this.debugLog("Connection test:",t?"SUCCESS":"FAILED"),t}catch(e){return this.debugLog("Connection test error:",e),!1}}async getTenantConfig(){try{let e=await fetch("".concat(this.config.apiUrl,"/tenants/").concat(this.config.tenantId),{method:"GET",headers:{"X-Tenant-ID":this.config.tenantId}});if(!e.ok)throw Error("Failed to get tenant config: ".concat(e.statusText));let t=await e.json();return this.debugLog("Tenant config:",t),t}catch(e){throw this.debugLog("Failed to get tenant config:",e),e}}async getConversationHistory(){try{let e=await fetch("".concat(this.config.apiUrl,"/conversations/").concat(this.config.sessionId),{method:"GET",headers:{"X-Tenant-ID":this.config.tenantId}});if(!e.ok)return this.debugLog("No conversation history available"),[];let t=await e.json();return this.debugLog("Loaded conversation history:",t.length,"messages"),t}catch(e){return this.debugLog("Failed to load conversation history:",e),[]}}async clearConversationHistory(){try{let e=await fetch("".concat(this.config.apiUrl,"/conversations/").concat(this.config.sessionId),{method:"DELETE",headers:{"X-Tenant-ID":this.config.tenantId}});if(!e.ok)throw Error("Failed to clear conversation: ".concat(e.statusText));this.debugLog("Conversation history cleared")}catch(e){throw this.debugLog("Failed to clear conversation history:",e),e}}constructor(e){this.abortController=null,this.config=e,this.debugLog("WebAI API initialized with config:",e)}};let WebAITenantSetupApi=class WebAITenantSetupApi extends WebAIApi{async registerTenant(e){try{let t=i.env.NEXT_PUBLIC_WEBAI_ADMIN_KEY;if(!t)throw Error("NEXT_PUBLIC_WEBAI_ADMIN_KEY environment variable is required");let a=await fetch("".concat(this.config.apiUrl,"/register-tenant"),{method:"POST",headers:{"Content-Type":"application/json","X-Admin-Key":t},body:JSON.stringify(e)});if(!a.ok){let e=await a.text().catch(()=>"Unknown error"),t="HTTP ".concat(a.status,": ").concat(a.statusText);try{let a=JSON.parse(e);t=a.detail||t}catch(a){e&&(t=e)}throw Error(t)}let s=await a.json();return this.debugLog("Tenant registered successfully:",s),s}catch(e){throw this.debugLog("Failed to register tenant:",e),e}}async validateOpenRouterKey(e){try{let t=await fetch("".concat(this.config.apiUrl,"/api-keys/validate"),{method:"POST",headers:{"Content-Type":"application/json","X-Tenant-ID":this.config.tenantId},body:JSON.stringify({api_key:e,provider:"openrouter"})});if(!t.ok)throw Error("Validation failed: ".concat(t.statusText));let a=await t.json();return this.debugLog("API key validation result:",a),a}catch(e){throw this.debugLog("Failed to validate API key:",e),e}}async getSystemCapabilities(){try{let e=await fetch("".concat(this.config.apiUrl,"/rag/processing-capabilities"),{method:"GET",headers:{"X-Tenant-ID":this.config.tenantId}});if(!e.ok)throw Error("Failed to get capabilities: ".concat(e.statusText));let t=await e.json();return this.debugLog("System capabilities:",t),t}catch(e){throw this.debugLog("Failed to get system capabilities:",e),e}}async analyzeFile(e){try{let t=new FormData;t.append("file",e),t.append("tenant_id",this.config.tenantId);let a=await fetch("".concat(this.config.apiUrl,"/rag/analyze-file"),{method:"POST",headers:{"X-Tenant-ID":this.config.tenantId},body:t});if(!a.ok)throw Error("File analysis failed: ".concat(a.statusText));let i=await a.json();return this.debugLog("File analysis result:",i),i}catch(e){throw this.debugLog("Failed to analyze file:",e),e}}async *processFileStreaming(e,t){try{var a;let i=new FormData;i.append("file",e),i.append("tenant_id",this.config.tenantId),i.append("schema_config",JSON.stringify(t));let s=await fetch("".concat(this.config.apiUrl,"/rag/ingest-file-streaming"),{method:"POST",headers:{"X-Tenant-ID":this.config.tenantId},body:i});if(!s.ok)throw Error("File processing failed: ".concat(s.statusText));let n=null===(a=s.body)||void 0===a?void 0:a.getReader();if(!n)throw Error("No response body available");let r=new TextDecoder,o="";for(;;){let e;let{done:t,value:a}=await n.read();if(t)break;for(o+=r.decode(a,{stream:!0});-1!==(e=o.indexOf("\n"));){let t=o.slice(0,e).trimEnd();if(o=o.slice(e+1),!t.startsWith("data: "))continue;let a=t.slice(6).trim();if("[DONE]"===a){this.debugLog("File processing completed");return}try{let e=JSON.parse(a);this.debugLog("Processing progress:",e),yield e}catch(e){this.config.debug&&console.warn("[WebAI API] Parse error:",e,"for data:",a)}}}}catch(e){throw this.debugLog("Failed to process file:",e),e}}async processFileAsync(e,t){try{let a=new FormData;a.append("file",e),a.append("tenant_id",this.config.tenantId),a.append("schema_config",JSON.stringify(t));let i=await fetch("".concat(this.config.apiUrl,"/rag/ingest-file-async"),{method:"POST",headers:{"X-Tenant-ID":this.config.tenantId},body:a});if(!i.ok)throw Error("Async processing failed: ".concat(i.statusText));let s=await i.json();return this.debugLog("Async processing started:",s),s}catch(e){throw this.debugLog("Failed to start async processing:",e),e}}async getProcessingStatus(e){try{let t=await fetch("".concat(this.config.apiUrl,"/rag/job-status/").concat(e),{method:"GET",headers:{"X-Tenant-ID":this.config.tenantId}});if(!t.ok)throw Error("Failed to get job status: ".concat(t.statusText));let a=await t.json();return this.debugLog("Job status:",a),a}catch(e){throw this.debugLog("Failed to get job status:",e),e}}};function createTenantSetupApi(){let e=new URLSearchParams(window.location.search),t={apiUrl:"https://web3ai-backend-v65-api-180395924844.us-central1.run.app",tenantId:e.get("tenant")||"setup",sessionId:e.get("session")||"setup",useRAG:!1,ragTopK:4,debug:"true"===e.get("debug")};return new WebAITenantSetupApi(t)}},9007:function(e,t,a){"use strict";a.r(t),a.d(t,{__N_SSG:function(){return d},default:function(){return chat}});var i=a(5893),s=a(5379),n=a.n(s),r=a(7294),o=a(9008),c=a.n(o),l=a(2905);function ChatMessages(e){let{messages:t,isLoading:a,isStreaming:s}=e;return(0,i.jsxs)("div",{className:"jsx-af34b5b61947c464 chat-messages",children:[t.map((e,t)=>(0,i.jsxs)("div",{className:"jsx-af34b5b61947c464 "+"message message-".concat(e.role),children:[(0,i.jsx)("div",{className:"jsx-af34b5b61947c464 message-avatar",children:"user"===e.role?"\uD83D\uDC64":"\uD83E\uDD16"}),(0,i.jsx)("div",{className:"jsx-af34b5b61947c464 message-content",children:"assistant"===e.role?(0,i.jsx)("div",{dangerouslySetInnerHTML:{__html:e.content.replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>").replace(/\*([^*]+)\*/g,"<em>$1</em>").replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank">$1</a>').replace(/\n/g,"<br>")},className:"jsx-af34b5b61947c464"}):(0,i.jsx)("p",{className:"jsx-af34b5b61947c464",children:e.content})})]},e.id||t)),a&&(0,i.jsxs)("div",{className:"jsx-af34b5b61947c464 message message-assistant",children:[(0,i.jsx)("div",{className:"jsx-af34b5b61947c464 message-avatar",children:"\uD83E\uDD16"}),(0,i.jsx)("div",{className:"jsx-af34b5b61947c464 message-content",children:(0,i.jsxs)("div",{className:"jsx-af34b5b61947c464 typing-indicator",children:[(0,i.jsx)("span",{className:"jsx-af34b5b61947c464"}),(0,i.jsx)("span",{className:"jsx-af34b5b61947c464"}),(0,i.jsx)("span",{className:"jsx-af34b5b61947c464"})]})})]}),(0,i.jsx)(n(),{id:"af34b5b61947c464",children:".chat-messages.jsx-af34b5b61947c464{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;gap:1rem}.message.jsx-af34b5b61947c464{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:.75rem;max-width:100%}.message-avatar.jsx-af34b5b61947c464{width:32px;height:32px;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;background:rgba(255,255,255,.1);display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;font-size:14px}.message-content.jsx-af34b5b61947c464{-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-ms-flex:1;flex:1;background:rgba(255,255,255,.05);padding:.75rem 1rem;-webkit-border-radius:1rem;-moz-border-radius:1rem;border-radius:1rem;border:1px solid rgba(255,255,255,.1)}.message-user.jsx-af34b5b61947c464 .message-content.jsx-af34b5b61947c464{background:rgba(255,255,255,.1);border-color:rgba(255,255,255,.2)}.message-content.jsx-af34b5b61947c464 p.jsx-af34b5b61947c464{margin:0;line-height:1.5}.message-content.jsx-af34b5b61947c464 pre{background:rgba(0,0,0,.3);padding:1rem;-webkit-border-radius:.5rem;-moz-border-radius:.5rem;border-radius:.5rem;overflow-x:auto;margin:.5rem 0}.message-content.jsx-af34b5b61947c464 code.inline-code{background:rgba(255,255,255,.1);padding:.2rem .4rem;-webkit-border-radius:.25rem;-moz-border-radius:.25rem;border-radius:.25rem;font-size:.9em}.message-content.jsx-af34b5b61947c464 .table-wrapper{overflow-x:auto;margin:.5rem 0}.message-content.jsx-af34b5b61947c464 table{width:100%;border-collapse:collapse;border:1px solid rgba(255,255,255,.2)}.message-content.jsx-af34b5b61947c464 th,.message-content.jsx-af34b5b61947c464 td{padding:.5rem;border:1px solid rgba(255,255,255,.1);text-align:left}.message-content.jsx-af34b5b61947c464 th{background:rgba(255,255,255,.1);font-weight:600}.typing-indicator.jsx-af34b5b61947c464{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:.25rem;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}.typing-indicator.jsx-af34b5b61947c464 span.jsx-af34b5b61947c464{width:6px;height:6px;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;background:rgba(255,255,255,.6);-webkit-animation:typing 1.4s infinite ease-in-out;-moz-animation:typing 1.4s infinite ease-in-out;-o-animation:typing 1.4s infinite ease-in-out;animation:typing 1.4s infinite ease-in-out}.typing-indicator.jsx-af34b5b61947c464 span.jsx-af34b5b61947c464:nth-child(1){-webkit-animation-delay:-.32s;-moz-animation-delay:-.32s;-o-animation-delay:-.32s;animation-delay:-.32s}.typing-indicator.jsx-af34b5b61947c464 span.jsx-af34b5b61947c464:nth-child(2){-webkit-animation-delay:-.16s;-moz-animation-delay:-.16s;-o-animation-delay:-.16s;animation-delay:-.16s}@-webkit-keyframes typing{0%,80%,100%{-webkit-transform:scale(.8);transform:scale(.8);opacity:.5}40%{-webkit-transform:scale(1);transform:scale(1);opacity:1}}@-moz-keyframes typing{0%,80%,100%{-moz-transform:scale(.8);transform:scale(.8);opacity:.5}40%{-moz-transform:scale(1);transform:scale(1);opacity:1}}@-o-keyframes typing{0%,80%,100%{-o-transform:scale(.8);transform:scale(.8);opacity:.5}40%{-o-transform:scale(1);transform:scale(1);opacity:1}}@keyframes typing{0%,80%,100%{-webkit-transform:scale(.8);-moz-transform:scale(.8);-o-transform:scale(.8);transform:scale(.8);opacity:.5}40%{-webkit-transform:scale(1);-moz-transform:scale(1);-o-transform:scale(1);transform:scale(1);opacity:1}}"})]})}function ChatInput(e){let{value:t,onChange:a,onSend:s,disabled:o=!1,placeholder:c="Type your message..."}=e,l=(0,r.useRef)(null);return(0,r.useEffect)(()=>{l.current&&(l.current.style.height="auto",l.current.style.height="".concat(Math.min(l.current.scrollHeight,120),"px"))},[t]),(0,i.jsxs)("div",{className:"jsx-69d43a8b99a383ae chat-input-container",children:[(0,i.jsxs)("div",{className:"jsx-69d43a8b99a383ae input-wrapper",children:[(0,i.jsx)("textarea",{ref:l,value:t,onChange:e=>a(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),t.trim()&&!o&&s(t))},placeholder:c,disabled:o,rows:1,className:"jsx-69d43a8b99a383ae chat-textarea"}),(0,i.jsx)("button",{onClick:()=>{t.trim()&&!o&&s(t)},disabled:o||!t.trim(),"aria-label":"Send message",className:"jsx-69d43a8b99a383ae send-button",children:(0,i.jsx)("svg",{viewBox:"0 0 24 24",width:"20",height:"20",className:"jsx-69d43a8b99a383ae",children:(0,i.jsx)("path",{fill:"currentColor",d:"M2,21L23,12L2,3V10L17,12L2,14V21Z",className:"jsx-69d43a8b99a383ae"})})})]}),(0,i.jsx)(n(),{id:"69d43a8b99a383ae",children:".chat-input-container.jsx-69d43a8b99a383ae{padding:1rem;background:rgba(255,255,255,.02);border-top:1px solid rgba(255,255,255,.1)}.input-wrapper.jsx-69d43a8b99a383ae{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:.75rem;-webkit-box-align:end;-webkit-align-items:flex-end;-moz-box-align:end;-ms-flex-align:end;align-items:flex-end;max-width:100%}.chat-textarea.jsx-69d43a8b99a383ae{-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-ms-flex:1;flex:1;min-height:44px;max-height:120px;padding:.75rem;border:1px solid rgba(255,255,255,.2);-webkit-border-radius:12px;-moz-border-radius:12px;border-radius:12px;background:rgba(255,255,255,.05);color:#fff;font-family:inherit;font-size:14px;line-height:1.4;resize:none;outline:none;-webkit-transition:border-color.2s ease;-moz-transition:border-color.2s ease;-o-transition:border-color.2s ease;transition:border-color.2s ease}.chat-textarea.jsx-69d43a8b99a383ae:focus{border-color:rgba(255,255,255,.4)}.chat-textarea.jsx-69d43a8b99a383ae::-webkit-input-placeholder{color:rgba(255,255,255,.5)}.chat-textarea.jsx-69d43a8b99a383ae:-moz-placeholder{color:rgba(255,255,255,.5)}.chat-textarea.jsx-69d43a8b99a383ae::-moz-placeholder{color:rgba(255,255,255,.5)}.chat-textarea.jsx-69d43a8b99a383ae:-ms-input-placeholder{color:rgba(255,255,255,.5)}.chat-textarea.jsx-69d43a8b99a383ae::-ms-input-placeholder{color:rgba(255,255,255,.5)}.chat-textarea.jsx-69d43a8b99a383ae::placeholder{color:rgba(255,255,255,.5)}.chat-textarea.jsx-69d43a8b99a383ae:disabled{opacity:.6;cursor:not-allowed}.send-button.jsx-69d43a8b99a383ae{width:44px;height:44px;border:none;-webkit-border-radius:12px;-moz-border-radius:12px;border-radius:12px;background:#007bff;color:white;cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-transition:all.2s ease;-moz-transition:all.2s ease;-o-transition:all.2s ease;transition:all.2s ease;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0}.send-button.jsx-69d43a8b99a383ae:hover:not(:disabled){background:#0056b3;-webkit-transform:translatey(-1px);-moz-transform:translatey(-1px);-ms-transform:translatey(-1px);-o-transform:translatey(-1px);transform:translatey(-1px)}.send-button.jsx-69d43a8b99a383ae:active:not(:disabled){-webkit-transform:translatey(0);-moz-transform:translatey(0);-ms-transform:translatey(0);-o-transform:translatey(0);transform:translatey(0)}.send-button.jsx-69d43a8b99a383ae:disabled{opacity:.5;cursor:not-allowed;-webkit-transform:none;-moz-transform:none;-ms-transform:none;-o-transform:none;transform:none}@media(max-width:768px){.chat-input-container.jsx-69d43a8b99a383ae{padding:.75rem}.input-wrapper.jsx-69d43a8b99a383ae{gap:.5rem}.send-button.jsx-69d43a8b99a383ae{width:40px;height:40px}}"})]})}function ChatHeader(e){let{title:t,isConnected:a,ragEnabled:s=!1,onClear:r,onClose:o}=e;return(0,i.jsxs)("div",{className:"jsx-46536b5033f3c648 chat-header",children:[(0,i.jsxs)("div",{className:"jsx-46536b5033f3c648 header-left",children:[(0,i.jsx)("h1",{className:"jsx-46536b5033f3c648 chat-title",children:t}),(0,i.jsxs)("div",{className:"jsx-46536b5033f3c648 status-indicators",children:[(0,i.jsxs)("div",{className:"jsx-46536b5033f3c648 "+"status-indicator ".concat(a?"connected":"disconnected"),children:[(0,i.jsx)("div",{className:"jsx-46536b5033f3c648 status-dot"}),(0,i.jsx)("span",{className:"jsx-46536b5033f3c648",children:a?"Connected":"Connecting..."})]}),s&&(0,i.jsx)("div",{className:"jsx-46536b5033f3c648 rag-indicator",children:(0,i.jsx)("span",{className:"jsx-46536b5033f3c648",children:"\uD83E\uDDE0 RAG"})})]})]}),(0,i.jsxs)("div",{className:"jsx-46536b5033f3c648 header-actions",children:[r&&(0,i.jsx)("button",{onClick:r,title:"Clear conversation","aria-label":"Clear conversation",className:"jsx-46536b5033f3c648 header-button",children:(0,i.jsx)("svg",{viewBox:"0 0 24 24",width:"18",height:"18",className:"jsx-46536b5033f3c648",children:(0,i.jsx)("path",{fill:"currentColor",d:"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z",className:"jsx-46536b5033f3c648"})})}),o&&(0,i.jsx)("button",{onClick:o,title:"Close chat","aria-label":"Close chat",className:"jsx-46536b5033f3c648 header-button close-button",children:(0,i.jsx)("svg",{viewBox:"0 0 24 24",width:"18",height:"18",className:"jsx-46536b5033f3c648",children:(0,i.jsx)("path",{fill:"currentColor",d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z",className:"jsx-46536b5033f3c648"})})})]}),(0,i.jsx)(n(),{id:"46536b5033f3c648",children:".chat-header.jsx-46536b5033f3c648{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-moz-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;padding:1rem;background:rgba(255,255,255,.02);border-bottom:1px solid rgba(255,255,255,.1);min-height:60px}.header-left.jsx-46536b5033f3c648{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;gap:.25rem;-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-ms-flex:1;flex:1}.chat-title.jsx-46536b5033f3c648{margin:0;font-size:16px;font-weight:600;color:#fff;line-height:1.2}.status-indicators.jsx-46536b5033f3c648{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:.75rem;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}.status-indicator.jsx-46536b5033f3c648{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:.5rem;font-size:12px;color:rgba(255,255,255,.7)}.status-dot.jsx-46536b5033f3c648{width:8px;height:8px;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;background:#fbbf24;-webkit-transition:background-color.3s ease;-moz-transition:background-color.3s ease;-o-transition:background-color.3s ease;transition:background-color.3s ease}.status-indicator.connected.jsx-46536b5033f3c648 .status-dot.jsx-46536b5033f3c648{background:#10b981}.status-indicator.disconnected.jsx-46536b5033f3c648 .status-dot.jsx-46536b5033f3c648{background:#ef4444;-webkit-animation:pulse 2s infinite;-moz-animation:pulse 2s infinite;-o-animation:pulse 2s infinite;animation:pulse 2s infinite}@-webkit-keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}@-moz-keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}@-o-keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}.rag-indicator.jsx-46536b5033f3c648{padding:.25rem .5rem;background:rgba(59,130,246,.2);border:1px solid rgba(59,130,246,.3);-webkit-border-radius:12px;-moz-border-radius:12px;border-radius:12px;font-size:11px;color:#93c5fd}.header-actions.jsx-46536b5033f3c648{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:.5rem;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}.header-button.jsx-46536b5033f3c648{width:36px;height:36px;border:none;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;background:rgba(255,255,255,.1);color:rgba(255,255,255,.7);cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-transition:all.2s ease;-moz-transition:all.2s ease;-o-transition:all.2s ease;transition:all.2s ease}.header-button.jsx-46536b5033f3c648:hover{background:rgba(255,255,255,.2);color:#fff;-webkit-transform:translatey(-1px);-moz-transform:translatey(-1px);-ms-transform:translatey(-1px);-o-transform:translatey(-1px);transform:translatey(-1px)}.header-button.jsx-46536b5033f3c648:active{-webkit-transform:translatey(0);-moz-transform:translatey(0);-ms-transform:translatey(0);-o-transform:translatey(0);transform:translatey(0)}.close-button.jsx-46536b5033f3c648:hover{background:rgba(239,68,68,.2);color:#fca5a5}@media(max-width:768px){.chat-header.jsx-46536b5033f3c648{padding:.75rem}.chat-title.jsx-46536b5033f3c648{font-size:14px}.status-indicators.jsx-46536b5033f3c648{gap:.5rem}.header-button.jsx-46536b5033f3c648{width:32px;height:32px}}"})]})}function LoadingSpinner(e){let{size:t="medium",color:a="#ffffff"}=e,s={small:16,medium:24,large:32}[t];return(0,i.jsxs)("div",{className:n().dynamic([["bada0fe33990d53c",[a,a,a]]])+" loading-spinner",children:[(0,i.jsxs)("div",{style:{width:s,height:s},className:n().dynamic([["bada0fe33990d53c",[a,a,a]]])+" spinner",children:[(0,i.jsx)("div",{className:n().dynamic([["bada0fe33990d53c",[a,a,a]]])+" spinner-ring"}),(0,i.jsx)("div",{className:n().dynamic([["bada0fe33990d53c",[a,a,a]]])+" spinner-ring"}),(0,i.jsx)("div",{className:n().dynamic([["bada0fe33990d53c",[a,a,a]]])+" spinner-ring"})]}),(0,i.jsx)(n(),{id:"bada0fe33990d53c",dynamic:[a,a,a],children:".loading-spinner.__jsx-style-dynamic-selector{display:-webkit-inline-box;display:-webkit-inline-flex;display:-moz-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center}.spinner.__jsx-style-dynamic-selector{position:relative;display:inline-block}.spinner-ring.__jsx-style-dynamic-selector{position:absolute;top:0;left:0;width:100%;height:100%;border:2px solid transparent;border-top:2px solid ".concat(a,";-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;-webkit-animation:spin 1s linear infinite;-moz-animation:spin 1s linear infinite;-o-animation:spin 1s linear infinite;animation:spin 1s linear infinite}.spinner-ring.__jsx-style-dynamic-selector:nth-child(2){border-top-color:").concat(a,"80;-webkit-animation-delay:.1s;-moz-animation-delay:.1s;-o-animation-delay:.1s;animation-delay:.1s}.spinner-ring.__jsx-style-dynamic-selector:nth-child(3){border-top-color:").concat(a,"40;-webkit-animation-delay:.2s;-moz-animation-delay:.2s;-o-animation-delay:.2s;animation-delay:.2s}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-moz-keyframes spin{0%{-moz-transform:rotate(0deg);transform:rotate(0deg)}100%{-moz-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes spin{0%{-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{0%{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}")})]})}function ErrorMessage(e){let{message:t,onRetry:a,onDismiss:s}=e;return(0,i.jsxs)("div",{className:"jsx-7fd48c56a6ee8210 error-message",children:[(0,i.jsxs)("div",{className:"jsx-7fd48c56a6ee8210 error-content",children:[(0,i.jsx)("div",{className:"jsx-7fd48c56a6ee8210 error-icon",children:(0,i.jsx)("svg",{viewBox:"0 0 24 24",width:"20",height:"20",className:"jsx-7fd48c56a6ee8210",children:(0,i.jsx)("path",{fill:"currentColor",d:"M13,13H11V7H13M13,17H11V15H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z",className:"jsx-7fd48c56a6ee8210"})})}),(0,i.jsx)("div",{className:"jsx-7fd48c56a6ee8210 error-text",children:(0,i.jsx)("p",{className:"jsx-7fd48c56a6ee8210",children:t})})]}),(0,i.jsxs)("div",{className:"jsx-7fd48c56a6ee8210 error-actions",children:[a&&(0,i.jsx)("button",{onClick:a,className:"jsx-7fd48c56a6ee8210 error-button retry-button",children:"Retry"}),s&&(0,i.jsx)("button",{onClick:s,className:"jsx-7fd48c56a6ee8210 error-button dismiss-button",children:"Dismiss"})]}),(0,i.jsx)(n(),{id:"7fd48c56a6ee8210",children:".error-message.jsx-7fd48c56a6ee8210{background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.2);-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;padding:1rem;margin:.5rem 0}.error-content.jsx-7fd48c56a6ee8210{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:.75rem;-webkit-box-align:start;-webkit-align-items:flex-start;-moz-box-align:start;-ms-flex-align:start;align-items:flex-start;margin-bottom:.75rem}.error-icon.jsx-7fd48c56a6ee8210{color:#fca5a5;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-top:.1rem}.error-text.jsx-7fd48c56a6ee8210{-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-ms-flex:1;flex:1}.error-text.jsx-7fd48c56a6ee8210 p.jsx-7fd48c56a6ee8210{margin:0;color:#fca5a5;font-size:14px;line-height:1.4}.error-actions.jsx-7fd48c56a6ee8210{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:.5rem;-webkit-box-pack:end;-webkit-justify-content:flex-end;-moz-box-pack:end;-ms-flex-pack:end;justify-content:flex-end}.error-button.jsx-7fd48c56a6ee8210{padding:.5rem 1rem;border:none;-webkit-border-radius:6px;-moz-border-radius:6px;border-radius:6px;font-size:12px;font-weight:500;cursor:pointer;-webkit-transition:all.2s ease;-moz-transition:all.2s ease;-o-transition:all.2s ease;transition:all.2s ease}.retry-button.jsx-7fd48c56a6ee8210{background:#ef4444;color:white}.retry-button.jsx-7fd48c56a6ee8210:hover{background:#dc2626}.dismiss-button.jsx-7fd48c56a6ee8210{background:rgba(255,255,255,.1);color:rgba(255,255,255,.7)}.dismiss-button.jsx-7fd48c56a6ee8210:hover{background:rgba(255,255,255,.2);color:white}"})]})}var d=!0,chat=function(){var e;let t=function(){let e=function(){let[e,t]=(0,r.useState)({api:null,config:null,isEmbedded:!1,isReady:!1,isConnected:!1,error:null}),a=(0,r.useRef)(new Map),i=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e="true"===new URLSearchParams(window.location.search).get("embedded");if(t(t=>({...t,isEmbedded:e})),e){let e=new URLSearchParams(window.location.search),a={apiUrl:getApiUrl(),tenantId:e.get("tenant")||"default",sessionId:e.get("session")||"default",useRAG:"true"===e.get("rag"),ragTopK:parseInt(e.get("rag_top_k")||"4"),title:e.get("title")||"AI Assistant",debug:"true"===e.get("debug")},i=new l.OY(a);t(e=>({...e,api:i,config:a,isReady:!0}))}},[]),(0,r.useEffect)(()=>{if(!e.isEmbedded)return;let handleMessage=e=>{i.current||e.origin===window.location.origin||(i.current=e.origin);let{type:t,data:r}=e.data;switch(t){case"INIT_CONFIG":s(r);break;case"UPDATE_CONFIG":n(r);break;case"SEND_MESSAGE":o(r);break;case"FOCUS_REQUEST":c();break;case"PAGE_VISIBLE":d();break;case"WINDOW_RESIZE":b(r);break;default:let l=a.current.get(t);l&&l(r)}};return window.addEventListener("message",handleMessage),e.isEmbedded&&window.parent.postMessage({type:"IFRAME_READY"},"*"),()=>{window.removeEventListener("message",handleMessage)}},[e.isEmbedded]),(0,r.useEffect)(()=>{e.api&&!e.isConnected&&g()},[e.api]);let s=(0,r.useCallback)(e=>{let a={apiUrl:getApiUrl(),tenantId:e.tenantId||"default",sessionId:e.sessionId||"default",useRAG:e.useRAG||!1,ragTopK:e.ragTopK||4,title:e.title||"AI Assistant",debug:e.debug||!1},i=new l.OY(a);t(e=>({...e,api:i,config:a,isReady:!0,error:null})),console.log("[WebAI Hook] Initialized with config:",a)},[]),n=(0,r.useCallback)(a=>{if(e.api&&e.config){let i={...e.config,...a};e.api.updateConfig(i),t(e=>({...e,config:i})),console.log("[WebAI Hook] Config updated:",a)}},[e.api,e.config]),o=(0,r.useCallback)(e=>{console.log("[WebAI Hook] Send message requested:",e.message);let t=new CustomEvent("webai-send-message",{detail:e});window.dispatchEvent(t)},[]),c=(0,r.useCallback)(()=>{let e=document.querySelector('textarea, input[type="text"]');e&&e.focus()},[]),d=(0,r.useCallback)(()=>{console.log("[WebAI Hook] Page became visible")},[]),b=(0,r.useCallback)(e=>{console.log("[WebAI Hook] Parent window resized:",e);let t=new CustomEvent("webai-window-resize",{detail:e});window.dispatchEvent(t)},[]),f=(0,r.useCallback)((t,a)=>{e.isEmbedded&&i.current?(window.parent.postMessage({type:t,data:a},i.current),console.log("[WebAI Hook] Sent to parent:",t,a)):e.isEmbedded&&(window.parent.postMessage({type:t,data:a},"*"),console.log("[WebAI Hook] Sent to parent (any origin):",t,a))},[e.isEmbedded]),m=(0,r.useCallback)(a=>{if(e.api&&e.config){let i={...e.config,...a};e.api.updateConfig(i),t(e=>({...e,config:i}))}},[e.api,e.config]),g=(0,r.useCallback)(async()=>{if(!e.api)return!1;try{let a=await e.api.testConnection();return t(e=>({...e,isConnected:a,error:a?null:"Connection failed"})),a}catch(a){let e=a instanceof Error?a.message:"Connection test failed";return t(t=>({...t,isConnected:!1,error:e})),!1}},[e.api]),x=(0,r.useCallback)(e=>{o({message:e})},[o]),p=(0,r.useCallback)(async()=>{if(e.api)try{await e.api.clearConversationHistory(),console.log("[WebAI Hook] Conversation cleared")}catch(e){console.error("[WebAI Hook] Failed to clear conversation:",e)}},[e.api]),getApiUrl=()=>"https://web3ai-backend-v65-api-180395924844.us-central1.run.app",h=(0,r.useCallback)((e,t)=>{a.current.set(e,t)},[]),u=(0,r.useCallback)(e=>{a.current.delete(e)},[]);return{...e,updateConfig:m,testConnection:g,sendMessage:x,clearConversation:p,sendToParent:f,addMessageHandler:h,removeMessageHandler:u}}(),[t,a]=(0,r.useState)(!1),i=(0,r.useCallback)(async function*(t){if(!e.api)throw Error("WebAI API not available");a(!0);try{for await(let a of e.api.chat(t))if(yield a,a.finished)break}finally{a(!1)}},[e.api]),s=(0,r.useCallback)(()=>{e.api&&(e.api.cancel(),a(!1))},[e.api]);return{...e,isStreaming:t,streamChat:i,cancelStream:s}}(),{addListener:a}=function(){let e=(0,r.useCallback)((e,t)=>(window.addEventListener(e,t),()=>window.removeEventListener(e,t)),[]);return{addListener:e}}(),[s,o]=(0,r.useState)([]),[d,b]=(0,r.useState)(""),[f,m]=(0,r.useState)(!1),[g,x]=(0,r.useState)(null),[p,h]=(0,r.useState)("AI Assistant"),u=(0,r.useRef)(null),y=(0,r.useRef)(null),w=(0,r.useCallback)(()=>{var e;null===(e=u.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[]);(0,r.useEffect)(()=>{w()},[s,w]),(0,r.useEffect)(()=>{let e=a("webai-window-resize",e=>{let{isMobile:t}=e.detail;y.current&&(y.current.className=t?"chat-container mobile":"chat-container desktop")});return e},[a]),(0,r.useEffect)(()=>{let e=a("webai-send-message",e=>{let{message:t}=e.detail;t&&"string"==typeof t&&handleSendMessage(t)});return e},[a]),(0,r.useEffect)(()=>{var e;(null===(e=t.config)||void 0===e?void 0:e.title)&&h(t.config.title)},[t.config]),(0,r.useEffect)(()=>{t.isReady&&t.api&&0===s.length&&loadConversationHistory()},[t.isReady,t.api]);let loadConversationHistory=async()=>{if(t.api)try{let e=await t.api.getConversationHistory();e.length>0&&o(e)}catch(e){console.warn("Failed to load conversation history:",e)}},handleSendMessage=async e=>{if(!e.trim()||!t.api||t.isStreaming)return;let a={role:"user",content:e.trim(),id:"user-".concat(Date.now()),timestamp:Date.now()};o(e=>[...e,a]),b(""),x(null),m(!0);let i={role:"assistant",content:"",id:"assistant-".concat(Date.now()),timestamp:Date.now()};o(e=>[...e,i]);try{let e=[...s,a];for await(let a of t.streamChat(e)){if(a.error)throw Error(a.error);if(a.delta&&a.content&&o(e=>e.map(e=>e.id===i.id?{...e,content:e.content+a.content}:e)),a.finished)break}}catch(e){x(e instanceof Error?e.message:"An error occurred"),o(e=>e.filter(e=>e.id!==i.id))}finally{m(!1)}},handleClearConversation=async()=>{try{t.api&&await t.clearConversation(),o([]),x(null),t.sendToParent("CONVERSATION_CLEARED")}catch(e){x("Failed to clear conversation")}};return t.isReady?t.error&&!t.isConnected?(0,i.jsxs)("div",{className:"embedded-chat error",children:[(0,i.jsx)(c(),{children:(0,i.jsxs)("title",{children:["Error - ",p]})}),(0,i.jsx)("div",{className:"error-container",children:(0,i.jsx)(ErrorMessage,{message:t.error,onRetry:()=>t.testConnection()})})]}):(0,i.jsxs)("div",{ref:y,className:"jsx-4f2600eec5317548 embedded-chat",children:[(0,i.jsxs)(c(),{children:[(0,i.jsx)("title",{className:"jsx-4f2600eec5317548",children:p}),(0,i.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1",className:"jsx-4f2600eec5317548"}),(0,i.jsx)("meta",{name:"description",content:"AI Chat Assistant powered by WebAI",className:"jsx-4f2600eec5317548"})]}),(0,i.jsx)(ChatHeader,{title:p,isConnected:t.isConnected,ragEnabled:(null===(e=t.config)||void 0===e?void 0:e.useRAG)||!1,onClear:handleClearConversation,onClose:()=>t.sendToParent("CLOSE_WIDGET")}),(0,i.jsxs)("div",{className:"jsx-4f2600eec5317548 chat-body",children:[(0,i.jsx)(ChatMessages,{messages:s,isLoading:f,isStreaming:t.isStreaming}),(0,i.jsx)("div",{ref:u,className:"jsx-4f2600eec5317548"})]}),g&&(0,i.jsx)(ErrorMessage,{message:g,onRetry:()=>{d.trim()&&handleSendMessage(d)},onDismiss:()=>x(null)}),(0,i.jsx)(ChatInput,{value:d,onChange:b,onSend:handleSendMessage,disabled:t.isStreaming||!t.isConnected,placeholder:t.isConnected?"Type your message...":"Connecting..."}),(0,i.jsx)(n(),{id:"4f2600eec5317548",children:'.embedded-chat.jsx-4f2600eec5317548{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;height:100vh;background:#000;color:#fff;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;overflow:hidden}.embedded-chat.loading.jsx-4f2600eec5317548,.embedded-chat.error.jsx-4f2600eec5317548{-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}.loading-container.jsx-4f2600eec5317548,.error-container.jsx-4f2600eec5317548{text-align:center;padding:2rem}.loading-container.jsx-4f2600eec5317548 p.jsx-4f2600eec5317548{margin-top:1rem;color:rgba(255,255,255,.7)}.chat-body.jsx-4f2600eec5317548{-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-ms-flex:1;flex:1;overflow-y:auto;padding:1rem;scroll-behavior:smooth}.chat-body.jsx-4f2600eec5317548::-webkit-scrollbar{width:6px}.chat-body.jsx-4f2600eec5317548::-webkit-scrollbar-track{background:rgba(255,255,255,.02)}.chat-body.jsx-4f2600eec5317548::-webkit-scrollbar-thumb{background:rgba(255,255,255,.1);-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px}.chat-body.jsx-4f2600eec5317548::-webkit-scrollbar-thumb:hover{background:rgba(255,255,255,.15)}.chat-container.mobile.jsx-4f2600eec5317548 .chat-body.jsx-4f2600eec5317548{padding:.5rem}@media(max-width:768px){.embedded-chat.jsx-4f2600eec5317548{font-size:14px}.chat-body.jsx-4f2600eec5317548{padding:.5rem}}'})]}):(0,i.jsxs)("div",{className:"embedded-chat loading",children:[(0,i.jsxs)(c(),{children:[(0,i.jsx)("title",{children:p}),(0,i.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"})]}),(0,i.jsxs)("div",{className:"loading-container",children:[(0,i.jsx)(LoadingSpinner,{}),(0,i.jsx)("p",{children:"Initializing chat..."})]})]})}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=246)}),_N_E=e.O()}]);