"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[47],{2047:function(e,t,r){r.d(t,{Gt:function(){return withSubscriptionProtection},a9:function(){return PaywallProvider},nL:function(){return usePaywall},qr:function(){return useSubscriptionAccess}});var i=r(5893),a=r(5379),s=r.n(a),o=r(7294),n=r(3400),c=r(8349);let l=(0,o.createContext)(void 0),PaywallProvider=e=>{let{children:t,autoCheckSubscription:r=!0,debugMode:a=!1}=e,[s,u]=(0,o.useState)(null),[d,b]=(0,o.useState)(null),[h,g]=(0,o.useState)(!1),[p,m]=(0,o.useState)(!0),[f,S]=(0,o.useState)(null),[x,C]=(0,o.useState)(!1),w=(0,o.useCallback)(function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a&&console.log("[PaywallProvider]",...t)},[a]);(0,o.useEffect)(()=>{y()},[]),(0,o.useEffect)(()=>{if(r&&p){let e=n.h7.getCachedCustomerId();e?k(e).finally(()=>{m(!1)}):m(!1)}},[r,p]);let y=(0,o.useCallback)(()=>{try{let e=n.h7.getCachedCustomerId(),t=n.h7.getCachedCustomerEmail();e&&t&&b({customer_id:e,email:t,created:0});let r=n.h7.getCachedSubscriptionStatus();w("Loaded cached subscription status:",r)}catch(e){w("Failed to load cached data:",e)}},[w]),k=(0,o.useCallback)(async e=>{try{g(!0),S(null);let t=e||n.h7.getCachedCustomerId();if(!t)return w("No customer ID available for subscription check"),!1;w("Checking subscription for customer:",t);let r=await n.h7.getSubscriptionStatus(t);if(r.has_subscription&&r.subscription_data)return u(r.subscription_data),w("Subscription found:",r.subscription_data),(0,c.BZ)(r.subscription_data.status);return u(null),w("No subscription found"),!1}catch(t){let e=t instanceof Error?t.message:"Failed to check subscription";return w("Subscription check error:",e),S(e),!1}finally{g(!1)}},[w]),_=(0,o.useCallback)(async()=>{let e=(null==d?void 0:d.customer_id)||n.h7.getCachedCustomerId();e&&await k(e)},[d,k]),v=(0,o.useCallback)((e,t)=>{let r={customer_id:"",email:e,name:t,created:Date.now()/1e3};b(r),w("Customer info set:",r)},[w]),I=(0,o.useCallback)(()=>{u(null),b(null),S(null),n.h7.clearCache(),w("Subscription data cleared")},[w]),L=!!s&&(0,c.BZ)(s.status),T=(null==s?void 0:s.status)||null;return(0,i.jsx)(l.Provider,{value:{subscription:s,customer:d,hasActiveSubscription:L,subscriptionStatus:T,isLoading:h,isInitializing:p,error:f,checkSubscription:k,refreshSubscription:_,setCustomerInfo:v,clearSubscriptionData:I,showPaywall:x,setShowPaywall:C},children:t})},usePaywall=()=>{let e=(0,o.useContext)(l);if(void 0===e)throw Error("usePaywall must be used within a PaywallProvider");return e},useSubscriptionAccess=()=>{let{hasActiveSubscription:e,isLoading:t,isInitializing:r}=usePaywall();return{hasAccess:e,isLoading:t||r,needsSubscription:!e&&!t&&!r}},withSubscriptionProtection=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},ProtectedComponent=r=>{let{hasAccess:a,isLoading:n,needsSubscription:c}=useSubscriptionAccess(),{setShowPaywall:l}=usePaywall();return((0,o.useEffect)(()=>{c&&!1!==t.showPaywall&&l(!0)},[c,l]),n)?(0,i.jsx)(i.Fragment,{children:t.loadingComponent||(0,i.jsxs)("div",{className:"jsx-fe4b9d12fc145224 subscription-loading",children:[(0,i.jsx)("div",{className:"jsx-fe4b9d12fc145224 loading-spinner"}),(0,i.jsx)("p",{className:"jsx-fe4b9d12fc145224",children:"Checking subscription..."}),(0,i.jsx)(s(),{id:"fe4b9d12fc145224",children:".subscription-loading.jsx-fe4b9d12fc145224{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;min-height:200px;text-align:center}.loading-spinner.jsx-fe4b9d12fc145224{width:40px;height:40px;border:3px solid rgba(255,255,255,.1);border-top:3px solid#007bff;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;-webkit-animation:spin 1s linear infinite;-moz-animation:spin 1s linear infinite;-o-animation:spin 1s linear infinite;animation:spin 1s linear infinite;margin-bottom:1rem}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-moz-keyframes spin{0%{-moz-transform:rotate(0deg);transform:rotate(0deg)}100%{-moz-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes spin{0%{-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{0%{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}p.jsx-fe4b9d12fc145224{color:rgba(255,255,255,.7);margin:0}"})]})}):c?t.redirectTo?(window.location.href=t.redirectTo,null):(0,i.jsx)(i.Fragment,{children:t.blockedComponent||(0,i.jsxs)("div",{className:"jsx-a2b4dda25c201926 subscription-required",children:[(0,i.jsx)("div",{className:"jsx-a2b4dda25c201926 blocked-icon",children:"\uD83D\uDD12"}),(0,i.jsx)("h2",{className:"jsx-a2b4dda25c201926",children:"Subscription Required"}),(0,i.jsx)("p",{className:"jsx-a2b4dda25c201926",children:"This feature requires an active WebAI subscription. Please subscribe to continue."}),(0,i.jsx)("button",{onClick:()=>l(!0),className:"jsx-a2b4dda25c201926 subscribe-button",children:"Subscribe Now ($2/month)"}),(0,i.jsx)(s(),{id:"a2b4dda25c201926",children:".subscription-required.jsx-a2b4dda25c201926{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;min-height:300px;text-align:center;padding:2rem}.blocked-icon.jsx-a2b4dda25c201926{font-size:4rem;margin-bottom:1rem;opacity:.7}h2.jsx-a2b4dda25c201926{margin:0 0 1rem 0;color:#fff;font-size:1.75rem;font-weight:600}p.jsx-a2b4dda25c201926{color:rgba(255,255,255,.7);margin:0 0 2rem 0;line-height:1.5;max-width:400px}.subscribe-button.jsx-a2b4dda25c201926{background:#007bff;color:#fff;border:none;padding:1rem 2rem;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;font-weight:600;font-size:1rem;cursor:pointer;-webkit-transition:all.2s ease;-moz-transition:all.2s ease;-o-transition:all.2s ease;transition:all.2s ease}.subscribe-button.jsx-a2b4dda25c201926:hover{background:#0056b3;-webkit-transform:translatey(-2px);-moz-transform:translatey(-2px);-ms-transform:translatey(-2px);-o-transform:translatey(-2px);transform:translatey(-2px);-webkit-box-shadow:0 4px 12px rgba(0,123,255,.3);-moz-box-shadow:0 4px 12px rgba(0,123,255,.3);box-shadow:0 4px 12px rgba(0,123,255,.3)}"})]})}):(0,i.jsx)(e,{...r})};return ProtectedComponent.displayName="withSubscriptionProtection(".concat(e.displayName||e.name,")"),ProtectedComponent}},8349:function(e,t,r){let i;r.d(t,{BZ:function(){return hasActiveSubscription},d2:function(){return getStripe},if:function(){return getSubscriptionStatusColor},kU:function(){return formatSubscriptionStatus},sN:function(){return c}});var a=r(2859),s=r(3454);let o="pk_live_51RyCT8CaH00jkWa3mAiICBrzcASMlp5suMGEW9yt4GUqzLwtS39i0Vl3v2h6brntRYrRB8lisjH8cYhcRPHwH5Pf00UaLZHtNK",n=o&&o.startsWith("pk_")&&o.length>20;if(!n){let e="NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY environment variable is not set or invalid. Current value: ".concat(o||"undefined",". Please add your actual Stripe publishable key to your environment variables.");throw console.error("\uD83D\uDEA8 STRIPE ERROR:",e),Error(e)}let getStripe=()=>n?(i||(i=(0,a.J)(o)),i):(console.warn("⚠️ STRIPE: Cannot initialize Stripe - invalid or missing publishable key"),Promise.resolve(null)),c={appearance:{theme:"night",variables:{colorPrimary:"#007bff",colorBackground:"#1a1a1a",colorText:"#ffffff",colorDanger:"#df1b41",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',spacingUnit:"6px",borderRadius:"8px"},rules:{".Tab":{backgroundColor:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.8)"},".Tab:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)",color:"#ffffff"},".Tab--selected":{backgroundColor:"#007bff",color:"#ffffff"},".Input":{backgroundColor:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.2)",color:"#ffffff"},".Input:focus":{border:"1px solid #007bff",boxShadow:"0 0 0 2px rgba(0, 123, 255, 0.2)"},".Label":{color:"rgba(255, 255, 255, 0.9)",fontWeight:"500"}}}};c.appearance,s.env.NEXT_PUBLIC_STRIPE_PRICE_ID;let hasActiveSubscription=e=>"active"===e||"trialing"===e,formatSubscriptionStatus=e=>{if(!e)return"No subscription";switch(e){case"active":return"Active";case"trialing":return"Trial Period";case"past_due":return"Payment Past Due";case"canceled":return"Canceled";case"unpaid":return"Unpaid";case"incomplete":return"Incomplete";case"incomplete_expired":return"Expired";default:return"Inactive"}},getSubscriptionStatusColor=e=>{if(!e)return"#6b7280";switch(e){case"active":case"trialing":return"#10b981";case"past_due":case"unpaid":return"#f59e0b";case"canceled":case"incomplete_expired":return"#ef4444";case"incomplete":return"#8b5cf6";default:return"#6b7280"}}},3400:function(e,t,r){r.d(t,{h7:function(){return a}});let getApiUrl=()=>"https://web3ai-backend-v34-api-180395924844.us-central1.run.app",i={CUSTOMER_ID:"webai_customer_id",CUSTOMER_EMAIL:"webai_customer_email",SUBSCRIPTION_STATUS:"webai_subscription_status",SUBSCRIPTION_CACHE_TIME:"webai_subscription_cache_time",SUBSCRIPTION_DATA:"webai_subscription_data"},a=new class{debugLog(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];this.debug&&console.log("[Subscription API]",...t)}getHeaders(){return{"Content-Type":"application/json"}}async handleResponse(e){if(!e.ok){let t=await e.text().catch(()=>"Unknown error"),r="HTTP ".concat(e.status,": ").concat(e.statusText);try{let e=JSON.parse(t);r=e.detail||r}catch(e){t&&(r=t)}throw Error(r)}return e.json()}setLocalStorage(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(e){this.debugLog("Failed to set localStorage:",e)}}getLocalStorage(e){try{let t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(e){return this.debugLog("Failed to get localStorage:",e),null}}removeLocalStorage(e){try{localStorage.removeItem(e)}catch(e){this.debugLog("Failed to remove localStorage:",e)}}isCacheValid(){let e=this.getLocalStorage(i.SUBSCRIPTION_CACHE_TIME);if(!e)return!1;let t=Date.now();return t-e<3e5}getCachedSubscriptionData(){return this.isCacheValid()?this.getLocalStorage(i.SUBSCRIPTION_DATA):null}cacheSubscriptionData(e){this.setLocalStorage(i.SUBSCRIPTION_DATA,e),this.setLocalStorage(i.SUBSCRIPTION_CACHE_TIME,Date.now()),this.setLocalStorage(i.SUBSCRIPTION_STATUS,(null==e?void 0:e.status)||null)}getCachedCustomerId(){return this.getLocalStorage(i.CUSTOMER_ID)}getCachedCustomerEmail(){return this.getLocalStorage(i.CUSTOMER_EMAIL)}getCachedSubscriptionStatus(){return this.isCacheValid()?this.getLocalStorage(i.SUBSCRIPTION_STATUS):null}clearCache(){Object.values(i).forEach(e=>{this.removeLocalStorage(e)}),this.debugLog("Subscription cache cleared")}async createCustomer(e){this.debugLog("Creating customer:",e.email);let t=await fetch("".concat(this.apiUrl,"/subscriptions/create-customer"),{method:"POST",headers:this.getHeaders(),body:JSON.stringify(e)}),r=await this.handleResponse(t);return this.setLocalStorage(i.CUSTOMER_ID,r.customer_id),this.setLocalStorage(i.CUSTOMER_EMAIL,r.email),this.debugLog("Customer created:",r.customer_id),r}async findCustomerByEmail(e){this.debugLog("Finding customer by email:",e);let t=await fetch("".concat(this.apiUrl,"/subscriptions/find-customer-by-email"),{method:"POST",headers:this.getHeaders(),body:JSON.stringify({email:e})}),r=await this.handleResponse(t);return r.found&&r.customer_data&&(this.setLocalStorage(i.CUSTOMER_ID,r.customer_data.customer_id),this.setLocalStorage(i.CUSTOMER_EMAIL,r.customer_data.email)),this.debugLog("Customer search result:",r),r}async createSubscription(e){this.debugLog("Creating subscription:",e);let t=await fetch("".concat(this.apiUrl,"/subscriptions/create-subscription"),{method:"POST",headers:this.getHeaders(),body:JSON.stringify(e)}),r=await this.handleResponse(t);return this.cacheSubscriptionData(r),this.debugLog("Subscription created:",r.subscription_id),r}async getSubscriptionStatus(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(t){let e=this.getCachedSubscriptionData();if(e)return this.debugLog("Using cached subscription data"),{has_subscription:!0,subscription_data:e}}this.debugLog("Fetching subscription status for customer:",e);let r=await fetch("".concat(this.apiUrl,"/subscriptions/status/").concat(e),{method:"GET",headers:this.getHeaders()}),i=await this.handleResponse(r);return this.cacheSubscriptionData(i.subscription_data||null),this.debugLog("Subscription status:",i),i}async cancelSubscription(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.debugLog("Cancelling subscription:",e,"immediate:",t);let r=await fetch("".concat(this.apiUrl,"/subscriptions/cancel/").concat(e),{method:"POST",headers:this.getHeaders(),body:JSON.stringify({immediate:t})}),i=await this.handleResponse(r);return this.clearCache(),this.debugLog("Subscription cancelled:",i),i}async getSubscriptionConfig(){this.debugLog("Fetching subscription config");let e=await fetch("".concat(this.apiUrl,"/subscriptions/config"),{method:"GET",headers:this.getHeaders()}),t=await this.handleResponse(e);return this.debugLog("Subscription config:",t),t}async checkHealth(){this.debugLog("Checking subscription service health");let e=await fetch("".concat(this.apiUrl,"/subscriptions/health"),{method:"GET",headers:this.getHeaders()}),t=await this.handleResponse(e);return this.debugLog("Subscription health:",t),t}async hasActiveSubscription(e){try{let t=e||this.getCachedCustomerId();if(!t)return this.debugLog("No customer ID available for subscription check"),!1;let r=await this.getSubscriptionStatus(t),i=r.has_subscription&&r.subscription_data&&("active"===r.subscription_data.status||"trialing"===r.subscription_data.status);return this.debugLog("Has active subscription:",i),i}catch(e){return this.debugLog("Error checking subscription status:",e),!1}}async getOrCreateCustomer(e,t){this.debugLog("Getting or creating customer for:",e);let r=await this.findCustomerByEmail(e);return r.found&&r.customer_data?(this.debugLog("Found existing customer"),r.customer_data):(this.debugLog("Creating new customer"),await this.createCustomer({email:e,name:t}))}constructor(e=!1){this.apiUrl=getApiUrl(),this.debug=e}}(!1)}}]);